{
  "kind": "build_request",
  "title": "Add Light/Dark Mode Theme Toggle",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-12",
      "text": "Implement app-wide light and dark mode support using Tailwind's class-based dark mode by toggling the `dark` class on the document root, leveraging the existing CSS variables in `frontend/src/index.css`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "add light and dark mode"
        ]
      },
      "acceptanceCriteria": [
        "When dark mode is enabled, the `dark` class is applied to `document.documentElement` and dark theme tokens take effect across all pages (Books, Topics, Question Detail, Saved Questions).",
        "When dark mode is disabled, the `dark` class is not present and light theme tokens take effect across all pages.",
        "No backend changes are required for theme switching."
      ]
    },
    {
      "id": "REQ-13",
      "text": "Add a theme toggle control to the persistent header (`frontend/src/components/AppHeader.tsx`) that lets the user switch between Light and Dark themes, with accessible labeling and keyboard operability.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "add light and dark mode"
        ]
      },
      "acceptanceCriteria": [
        "The header includes a clearly discoverable toggle button that switches theme immediately on click/tap.",
        "The toggle is keyboard accessible and includes an appropriate English `aria-label` that reflects the action/state (e.g., \"Switch to dark mode\" / \"Switch to light mode\").",
        "The toggle does not break existing header behavior (back navigation, Saved button, saved count badge)."
      ]
    },
    {
      "id": "REQ-14",
      "text": "Persist the user's theme preference in localStorage and initialize the theme on app load; if no preference is saved yet, default to the system color scheme (`prefers-color-scheme`).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "add light and dark mode"
        ]
      },
      "acceptanceCriteria": [
        "After selecting a theme, refreshing the page preserves the chosen theme.",
        "On a fresh browser (no saved preference), the app theme matches the system color scheme.",
        "Implementation does not require editing any files listed as immutable in SYSTEM_CONTEXT (notably `frontend/src/main.tsx` and Internet Identity hooks)."
      ]
    }
  ],
  "constraints": [
    "Frontend must not modify immutable paths listed in SYSTEM_CONTEXT (including `frontend/src/main.tsx`, `frontend/src/hooks/useInternetIdentity.ts(x)`, and `frontend/src/hooks/useActor.ts`).",
    "Use the existing Tailwind configuration (`darkMode: ['class']`) and existing theme tokens defined in `frontend/src/index.css`.",
    "Use English for all user-facing text related to theme toggling."
  ],
  "nonGoals": [
    "Do not add new authentication flows or third-party theming libraries.",
    "Do not add backend persistence for theme preference.",
    "Do not redesign the overall visual theme beyond what is necessary to support correct light/dark token switching."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}